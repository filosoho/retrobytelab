{% extends "store/base.html" %}
{% load static %}
{% load mathfilters %}
{% block content %}
  <section class="cart-summary d-flex flex-column px-4 mt-5 mb-5">
    <h1 class="headline pt-4">
      Your cart
      {% with qty_amount=cart|length %}
        {% if qty_amount > 0 %}
          <span id="cart-qty" class="d-inline-flex">({{ qty_amount }} Item{{ qty_amount|pluralize }})</span>
        {% else %}
          is empty.
        {% endif %}
      {% endwith %}
    </h1>
    <hr>
    <div class="cart-summary__content">
      <div class="cart-summary__products">
        {% if cart|length > 0 %}
          {% for item in cart %}
            {% with product=item.product %}
              <div class="product-item flex-column flex-sm-row mb-4">
                <img class="img-fluid"
                     height=""
                     width=""
                     alt="Responsive image"
                     src="{{ product.image.url }}">
                <div class="product-item__content d-flex justify-content-between">
                  <div class="d-flex flex-column justify-content-between">
                    <a href="{{ product.get_absolute_url }}"
                       class="text-decoration-underline text-reset">
                      <p class="product-item__title h5 mb-4">{{ product.title | capfirst }}</p>
                    </a>
                    <div class="d-flex flex-column flex-sm-row">
                      <!-- QTY STEPPER -->
                      <div class="qty-stepper">
                        <button type="button" class="qty-btn" data-action="decrement">−</button>
                        <input type="number"
                               id="qty-{{ product.id }}"
                               value="{{ item.qty }}"
                               min="1"
                               readonly />
                        <button type="button" class="qty-btn" data-action="increment">+</button>
                      </div>
                      <button type="button"
                              class="btn btn-primary btn-sm update-button align-self-start"
                              data-index="{{ product.id }}">Update</button>
                    </div>
                  </div>
                  <div class="d-flex flex-column justify-content-between align-items-end">
                    <div class="d-flex flex-column align-items-end">
                      <!-- PRICE -->
                      <p class="product-item__price fw-bold">£{{ product.price|mul:item.qty }}</p>
                      <p>({{ item.qty }}&nbsp;x&nbsp;£{{ product.price }})</p>
                    </div>
                    <!-- DELETE -->
                    <button type="button" class="btn btn-trash">
                      <i class="fa fa-trash align-self-end"
                         aria-hidden="true"
                         data-index="{{ product.id }}"></i>
                    </button>
                  </div>
                </div>
              </div>
              <hr />
            {% endwith %}
          {% endfor %}
        {% else %}
          <p class="cart-summary__empty-products">Looks like you haven’t added anything yet.</p>
          <a href="{% url 'store' %}" class="mt-3">Browse products</a>
        {% endif %}
      </div>
      {% if cart|length > 0 %}
        <div class="cart-summary__info d-flex flex-column">
          <div class="cart-summary__info-content">
            <h2 class="title">Summary</h2>
            <hr />
            <div class="d-flex justify-content-between">
              <p>Shipping</p>
              <div class="d-inline-flex">Free</div>
            </div>
            <div class="d-flex justify-content-between fw-bold ">
              <p>Total</p>
              <div id="total" class="d-inline-flex">£{{ cart.get_total }}</div>
            </div>
            <a href="{% url 'checkout' %}"
               id="update-button"
               class="btn btn-secondary btn-sm checkout-button">Continue to checkout</a>
          </div>
        </div>
      {% endif %}
    </div>
  </section>
{% endblock content %}
